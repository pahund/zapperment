#!/usr/bin/env node

const { MidiInterface } = require("../src/midi");
const { argv } = require("yargs");
const { initIntParameter, initStrParameter } = require("./utils");
const {
  DEFAULT_PORT,
  DEFAULT_CHANNEL,
  DEFAULT_CONTROLLER,
  DEFAULT_VALUE
} = require("./constants");

const midiPortName = initStrParameter({
  name: "port",
  def: DEFAULT_PORT,
  argv
});

const channel = initIntParameter({
  name: "channel",
  min: 0,
  max: 15,
  def: DEFAULT_CHANNEL,
  argv
});

const controller = initIntParameter({
  name: "controller",
  min: 0,
  max: 127,
  def: DEFAULT_CONTROLLER,
  argv
});

const value = initIntParameter({
  name: "value",
  min: 0,
  max: 127,
  def: DEFAULT_VALUE,
  argv
});

console.info("Sending MIDI controllerâ€¦");
console.info(`Port:       ${midiPortName}`);
console.info(`Channel:    ${channel}`);
console.info(`Controller: ${controller}`);
console.info(`Value:      ${value}`);

const midiInterface = new MidiInterface({ midiPortName });
midiInterface.sendControl(channel, controller, value);
