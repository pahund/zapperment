#!/usr/bin/env node

const { argv } = require("yargs");
const { MidiInterface } = require("@zapperment/midi");

const { initStrParameter } = require("@zapperment/command-line-utils");
const {
  DEFAULT_XTOUCH_PORT,
  DEFAULT_DRIVER_PORT
} = require("../lib/constants");

const xTouchMidiPortName = initStrParameter({
  name: "xtouch-port",
  def: process.env.XTOUCH_PORT || DEFAULT_XTOUCH_PORT,
  argv
});

const driverMidiPortName = initStrParameter({
  name: "driver-port",
  def: process.env.DRIVER_PORT || DEFAULT_DRIVER_PORT,
  argv
});

const xTouchMidiInterface = new MidiInterface({
  midiPortName: xTouchMidiPortName
});
const driverMidiInterface = new MidiInterface({
  midiPortName: driverMidiPortName
});
driverMidiInterface.receiveSysEx([0x0, 0x0, 0x66], message =>
  console.log(message)
);

function run() {
  setImmediate(run);
}
setTimeout(run, 100);
